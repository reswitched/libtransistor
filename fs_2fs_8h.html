<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>libtransistor: include/libtransistor/fs/fs.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">libtransistor
   </div>
   <div id="projectbrief">A userland library for the Nintendo Switch</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_d03fe6a9d6d72def7306d5181879229e.html">include</a></li><li class="navelem"><a class="el" href="dir_bf8142b8f5c4e7f569e2ea1bcb8277ee.html">libtransistor</a></li><li class="navelem"><a class="el" href="dir_42786c427919c8202fc6f9665d10ba1c.html">fs</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">fs.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Functions to setup filesystem.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;<a class="el" href="types_8h_source.html">libtransistor/types.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="inode_8h_source.html">libtransistor/fs/inode.h</a>&gt;</code><br/>
<code>#include &lt;sys/stat.h&gt;</code><br/>
</div><div class="textblock"><div class="dynheader">
Include dependency graph for fs.h:</div>
<div class="dyncontent">
<div class="center"><img src="fs_2fs_8h__incl.png" border="0" usemap="#include_2libtransistor_2fs_2fs_8h" alt=""/></div>
<map name="include_2libtransistor_2fs_2fs_8h" id="include_2libtransistor_2fs_2fs_8h">
<area shape="rect" id="node2" href="types_8h.html" title="Various system types. " alt="" coords="64,171,199,197"/><area shape="rect" id="node6" href="inode_8h.html" title="Inode structures and functions for virtual filesystem. " alt="" coords="170,96,320,123"/></map>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><img src="fs_2fs_8h__dep__incl.png" border="0" usemap="#include_2libtransistor_2fs_2fs_8hdep" alt=""/></div>
<map name="include_2libtransistor_2fs_2fs_8hdep" id="include_2libtransistor_2fs_2fs_8hdep">
<area shape="rect" id="node2" href="nx_8h.html" title="Central Switch header. Includes all others. " alt="" coords="5,96,168,123"/><area shape="rect" id="node3" href="nx_8hpp.html" title="Central Switch header. Includes all others (C++ version). " alt="" coords="19,171,153,213"/></map>
</div>
</div>
<p><a href="fs_2fs_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ac9da83f4bfe3ca7be7eaea49491156d5"><td class="memItemLeft" align="right" valign="top"><a class="el" href="types_8h.html#aaffb9e1025a873d711d912b261347c0c">result_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs_2fs_8h.html#ac9da83f4bfe3ca7be7eaea49491156d5">trn_fs_set_root</a> (<a class="el" href="structtrn__inode__t.html">trn_inode_t</a> *new_root)</td></tr>
<tr class="memdesc:ac9da83f4bfe3ca7be7eaea49491156d5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Change filesystem root.  <a href="#ac9da83f4bfe3ca7be7eaea49491156d5">More...</a><br/></td></tr>
<tr class="separator:ac9da83f4bfe3ca7be7eaea49491156d5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3d68d0fe1f0eb5c0b9bb8ab7c68946f4"><td class="memItemLeft" align="right" valign="top"><a class="el" href="types_8h.html#aaffb9e1025a873d711d912b261347c0c">result_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fs_2fs_8h.html#a3d68d0fe1f0eb5c0b9bb8ab7c68946f4">trn_fs_mount</a> (const char *name, <a class="el" href="structtrn__inode__t.html">trn_inode_t</a> root)</td></tr>
<tr class="memdesc:a3d68d0fe1f0eb5c0b9bb8ab7c68946f4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Mount a filesystem.  <a href="#a3d68d0fe1f0eb5c0b9bb8ab7c68946f4">More...</a><br/></td></tr>
<tr class="separator:a3d68d0fe1f0eb5c0b9bb8ab7c68946f4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a44b11ed6138e11c54f245d30fa78a3c2"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a44b11ed6138e11c54f245d30fa78a3c2"></a>
<a class="el" href="types_8h.html#aaffb9e1025a873d711d912b261347c0c">result_t</a>&#160;</td><td class="memItemRight" valign="bottom"><b>trn_fs_realpath</b> (const char *path, char **resolved_path)</td></tr>
<tr class="separator:a44b11ed6138e11c54f245d30fa78a3c2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a65e81cee39bba738a8961e3f16b264d5"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a65e81cee39bba738a8961e3f16b264d5"></a>
<a class="el" href="types_8h.html#aaffb9e1025a873d711d912b261347c0c">result_t</a>&#160;</td><td class="memItemRight" valign="bottom"><b>trn_fs_open</b> (int *fd, const char *path, int flags)</td></tr>
<tr class="separator:a65e81cee39bba738a8961e3f16b264d5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac3db895dc8cdd61504d84f45b9511b3d"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ac3db895dc8cdd61504d84f45b9511b3d"></a>
<a class="el" href="types_8h.html#aaffb9e1025a873d711d912b261347c0c">result_t</a>&#160;</td><td class="memItemRight" valign="bottom"><b>trn_fs_opendir</b> (<a class="el" href="structtrn__dir__t.html">trn_dir_t</a> *dir, const char *path)</td></tr>
<tr class="separator:ac3db895dc8cdd61504d84f45b9511b3d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a779437bfc68a541afdb6eb02468da383"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a779437bfc68a541afdb6eb02468da383"></a>
<a class="el" href="types_8h.html#aaffb9e1025a873d711d912b261347c0c">result_t</a>&#160;</td><td class="memItemRight" valign="bottom"><b>trn_fs_mkdir</b> (const char *path)</td></tr>
<tr class="separator:a779437bfc68a541afdb6eb02468da383"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a54afd20f034af5aa786004b08794fba9"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a54afd20f034af5aa786004b08794fba9"></a>
<a class="el" href="types_8h.html#aaffb9e1025a873d711d912b261347c0c">result_t</a>&#160;</td><td class="memItemRight" valign="bottom"><b>trn_fs_rename</b> (const char *oldpath, const char *newpath)</td></tr>
<tr class="separator:a54afd20f034af5aa786004b08794fba9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a275e6dd1db15f0b935c7e48d489a6df1"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a275e6dd1db15f0b935c7e48d489a6df1"></a>
<a class="el" href="types_8h.html#aaffb9e1025a873d711d912b261347c0c">result_t</a>&#160;</td><td class="memItemRight" valign="bottom"><b>trn_fs_unlink</b> (const char *path)</td></tr>
<tr class="separator:a275e6dd1db15f0b935c7e48d489a6df1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a22d1d7dd93b79cb4ed4ec0641acb4fcd"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a22d1d7dd93b79cb4ed4ec0641acb4fcd"></a>
<a class="el" href="types_8h.html#aaffb9e1025a873d711d912b261347c0c">result_t</a>&#160;</td><td class="memItemRight" valign="bottom"><b>trn_fs_rmdir</b> (const char *path)</td></tr>
<tr class="separator:a22d1d7dd93b79cb4ed4ec0641acb4fcd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a233a3566f73fcdbefecac4bfd3ddfd3e"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a233a3566f73fcdbefecac4bfd3ddfd3e"></a>
<a class="el" href="types_8h.html#aaffb9e1025a873d711d912b261347c0c">result_t</a>&#160;</td><td class="memItemRight" valign="bottom"><b>trn_fs_chdir</b> (const char *path)</td></tr>
<tr class="separator:a233a3566f73fcdbefecac4bfd3ddfd3e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6dbec5420ee0c20584ae4627e3aa32f9"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a6dbec5420ee0c20584ae4627e3aa32f9"></a>
<a class="el" href="types_8h.html#aaffb9e1025a873d711d912b261347c0c">result_t</a>&#160;</td><td class="memItemRight" valign="bottom"><b>trn_fs_stat</b> (const char *path, struct stat *st)</td></tr>
<tr class="separator:a6dbec5420ee0c20584ae4627e3aa32f9"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Functions to setup filesystem. </p>
<p>Libtransistor sports a virtual filesystem allowing to mount multiple kinds of filesystem (such as a squashfs, a networked filesystem, or an fsp-srv filesystem).</p>
<p>The filesystem root is purely virtual: you may not create files or directories directly under <code>/</code>. Instead, filesystems are mounted as direct descendants to it (through the <code>trn_fs_mount_fs</code> function). For instance, the canonical place to mount the SD card is <code>/sd</code>, which is done by calling <code>trn_fs_mount_fs("/sd", sdcardfs)</code>.</p>
<p>Anyone can create his own filesystem: they simply needs to create a struct of type <code><a class="el" href="structtrn__inode__t.html">trn_inode_t</a></code>. Libtransistor sports various filesystem implementations, mainly one backed by the FSP-SRV server of the switch, allowing mounting the sdcard, among other things.</p>
<p>Note that while functions like <code>trn_fs_open</code> are defined, those should probably <em>not</em> be used. Users should prefer instead to use the POSIX functions of the same name. This is because the error values, result_t, are not guaranteed to stay the same across filesystems. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a3d68d0fe1f0eb5c0b9bb8ab7c68946f4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="types_8h.html#aaffb9e1025a873d711d912b261347c0c">result_t</a> trn_fs_mount </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structtrn__inode__t.html">trn_inode_t</a>&#160;</td>
          <td class="paramname"><em>root</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Mount a filesystem. </p>
<p>Allows a user to mount a filesystem to the specified location. The location should be a full path.</p>
<p>Note that the current implementation is relatively simple: it forwards the call to mount to the root filesystem - if it is a mountfs. If you have swapped out the root filesystem with <code>trn_fs_set_root</code>, this will not work.</p>
<p>You could mount the game card partition (assuming correct privilege) like so:</p>
<div class="fragment"><div class="line"><a class="code" href="structipc__object__t.html">ifilesystem_t</a> gamecard_ifs;</div>
<div class="line"><a class="code" href="structtrn__inode__t.html">trn_inode_t</a> gamecard_inode;</div>
<div class="line"></div>
<div class="line">fsp_srv_mount_game_card_partition(&amp;gamecard_inode, 0, 0);</div>
<div class="line"><a class="code" href="fspfs_8h.html#aaa93bb2ef56a64c1d81c4448707c1e95">trn_fspfs_create</a>(&amp;gamecard_inode, gamecard_ifs);</div>
<div class="line"><a class="code" href="fs_2fs_8h.html#a3d68d0fe1f0eb5c0b9bb8ab7c68946f4">trn_fs_mount</a>(<span class="stringliteral">&quot;/gamecard&quot;</span>, gamecard_inode);</div>
</div><!-- fragment --> 
</div>
</div>
<a class="anchor" id="ac9da83f4bfe3ca7be7eaea49491156d5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="types_8h.html#aaffb9e1025a873d711d912b261347c0c">result_t</a> trn_fs_set_root </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structtrn__inode__t.html">trn_inode_t</a> *&#160;</td>
          <td class="paramname"><em>new_root</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Change filesystem root. </p>
<p>In libtransistor, the default root filesystem is mountfs. That filesystem is not very special: it's a filesystem containing only directories, each being a mountpoint. However, this behavior might not fit what all application's needs. For instance, when porting software, you might need to place some files in certain locations, or just need more leeway in how the root fs works. In these cases, you can use <code>trn_fs_set_root</code> to change what the root filesystem implementation is.</p>
<p>For instance, the following code will mount the sdcard at the root:</p>
<div class="fragment"><div class="line"><a class="code" href="structipc__object__t.html">ifilesystem_t</a> sdcard_ifs;</div>
<div class="line"><a class="code" href="structtrn__inode__t.html">trn_inode_t</a> sdcard_inode;</div>
<div class="line"></div>
<div class="line">fsp_srv_mount_sd_card(&amp;sdcard_ifs);</div>
<div class="line"><a class="code" href="fspfs_8h.html#aaa93bb2ef56a64c1d81c4448707c1e95">trn_fspfs_create</a>(&amp;sdcard_inode, sdcard_ifs);</div>
<div class="line"><a class="code" href="fs_2fs_8h.html#ac9da83f4bfe3ca7be7eaea49491156d5">trn_fs_set_root</a>(&amp;sdcard_inode);</div>
</div><!-- fragment --> 
</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Oct 3 2019 01:41:37 for libtransistor by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
